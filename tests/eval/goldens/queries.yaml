schemaVersion: "1.0.0"
datasetVersion: "v2025-11-docs-plain"
description: "VS Code TypeScript repository queries"
defaultParams:
  k: 10
  tool: "context_bundle"
  boostProfile: "default"
  timeoutMs: 30000

defaultRepo: "vscode"
repos:
  vscode:
    repoPath: "external/vscode"
    dbPath: "external/vscode/.kiri/index.duckdb"
  kiri-docs:
    repoPath: "."
    dbPath: "var/index.duckdb"
  kiri-docs-plain:
    repoPath: "tmp/docs-plain"
    dbPath: "tmp/docs-plain/.kiri/index.duckdb"

queries:
  - id: vscode-editor-contributions
    query: "registerWorkbenchContribution workbench part"
    tool: "context_bundle"
    intent: "Find where workbench contributions are registered for editor"
    category: "editor"
    repo: "vscode"
    expected:
      paths:
        - "src/vs/workbench/browser/workbench.ts"
        - "src/vs/workbench/browser/workbench.contribution.ts"
        - "src/vs/workbench/common/contributions.ts"
    tags: ["workbench", "contribution"]
    hints:
      - "registerWorkbenchContribution"
      - "workbench.contribution.ts"
      - "src/vs/workbench/browser/workbench.contribution.ts"
      - "src/vs/workbench/browser/workbench.ts"

  - id: vscode-tree-data-provider
    query: "TreeDataProvider registerTreeDataProvider"
    tool: "context_bundle"
    intent: "Locate TreeDataProvider API implementation"
    category: "api"
    repo: "vscode"
    expected:
      paths:
        - "src/vs/workbench/api/common/extHostTreeViews.ts"
    tags: ["tree", "extension"]
    hints:
      - "registerTreeDataProvider"
      - "extHostTreeViews.ts"
      - "src/vs/workbench/api/common/extHostTreeViews.ts"

  - id: vscode-debug-adapter
    query: "DebugAdapter tracker session"
    tool: "context_bundle"
    intent: "Inspect debug adapter tracker service"
    category: "debug"
    repo: "vscode"
    expected:
      paths:
        - "src/vs/workbench/contrib/debug/browser/debugAdapterManager.ts"
        - "src/vs/workbench/contrib/debug/common/debug.ts"
    tags: ["debug", "adapter"]
    hints:
      - "DebugAdapterTrackerFactory"
      - "debugAdapterManager.ts"
      - "src/vs/workbench/contrib/debug/browser/debugAdapterManager.ts"
      - "src/vs/workbench/contrib/debug/common/debug.ts"

  - id: vscode-terminal-prompt
    query: "terminal shell integration prompt decoration"
    tool: "context_bundle"
    intent: "Understand terminal shell integration prompt decoration"
    category: "feature"
    repo: "vscode"
    expected:
      paths:
        - "src/vs/workbench/contrib/terminal/browser/terminalInstance.ts"
        - "src/vs/workbench/api/common/extHostTerminalShellIntegration.ts"
        - "src/vs/platform/terminal/common/terminal.ts"
        - "src/vs/workbench/api/browser/mainThreadTerminalShellIntegration.ts"
        - "src/vs/workbench/contrib/terminal/browser/terminal.ts"
    tags: ["terminal", "shell", "prompt"]
    hints:
      - "terminalShellIntegration"
      - "registerDecorationTypes"
      - "terminalInstance"
      - "terminalShellIntegration.ts"
      - "terminalInstance.ts"
      - "src/vs/workbench/contrib/terminal/browser/terminalShellIntegration.ts"
      - "src/vs/workbench/contrib/terminal/browser/terminalInstance.ts"

  - id: vscode-notebook-kernel
    query: "NotebookKernelService resolveKernelSource"
    tool: "context_bundle"
    intent: "Trace notebook kernel service resolution logic"
    category: "api"
    repo: "vscode"
    expected:
      paths:
        - "src/vs/workbench/contrib/notebook/browser/services/notebookKernelServiceImpl.ts"
        - "src/vs/workbench/contrib/notebook/common/notebookKernelService.ts"
        - "src/vs/workbench/contrib/notebook/common/notebookCommon.ts"
        - "src/vs/workbench/contrib/notebook/browser/notebookBrowser.ts"
    tags: ["notebook", "kernel"]
    hints:
      - "NotebookKernelService"
      - "resolveKernelSource"
      - "notebookKernelServiceImpl"
      - "kernelServiceImpl.ts"
      - "src/vs/workbench/contrib/notebook/browser/services/notebookKernelServiceImpl.ts"
      - "src/vs/workbench/contrib/notebook/common/notebookKernelService.ts"

  - id: vscode-merge-editor
    query: "merge editor diff algorithm chunk alignment"
    tool: "context_bundle"
    intent: "Inspect merge editor diff chunk alignment logic"
    category: "feature"
    repo: "vscode"
    params:
      scoringProfile: "editor"
    expected:
      paths:
        - "src/vs/workbench/contrib/mergeEditor/browser/model/mergeEditorModel.ts"
        - "src/vs/workbench/contrib/mergeEditor/browser/view/viewModel.ts"
      patterns:
        - "src/vs/workbench/contrib/mergeEditor/**/*.ts"
    tags: ["merge", "diff", "editor"]
    hints:
      - "mergeEditorModel"
      - "chunkAlignment"
      - "mergeEditorViewModel"
      - "browser/model/mergeEditorModel.ts"
      - "browser/view/viewModel.ts"
      - "lineAlignment.ts"
      - "mergeEditorView"
      - "src/vs/workbench/contrib/mergeEditor/browser/model/mergeEditorModel.ts"
      - "src/vs/workbench/contrib/mergeEditor/browser/view/viewModel.ts"

  - id: vscode-color-theme
    query: "color registry registerColor workbench"
    tool: "context_bundle"
    intent: "Find color registry entries for workbench"
    category: "editor"
    repo: "vscode"
    expected:
      paths:
        - "src/vs/platform/theme/common/colorRegistry.ts"
        - "src/vs/workbench/common/theme.ts"
        - "src/vs/editor/common/core/editorColorRegistry.ts"
        - "src/vs/workbench/contrib/preferences/common/settingsEditorColorRegistry.ts"
    tags: ["color", "theme"]
    hints:
      - "registerColor"
      - "colorRegistry"
      - "colorRegistry.ts"
      - "src/vs/platform/theme/common/colorRegistry.ts"
      - "src/vs/workbench/common/theme.ts"

  - id: vscode-file-search
    query: "ripgrepTextSearchEngine fileWalker"
    tool: "context_bundle"
    intent: "Inspect file search implementation"
    category: "infra"
    repo: "vscode"
    expected:
      paths:
        - "src/vs/workbench/services/search/node/ripgrepTextSearchEngine.ts"
        - "src/vs/workbench/services/search/common/searchExtTypes.ts"
        - "src/vs/workbench/services/search/node/textSearchAdapter.ts"
    tags: ["search", "ripgrep"]
    hints:
      - "ripgrepTextSearchEngine"
      - "fileWalker"
      - "textSearchAdapter"
      - "ripgrepTextSearchEngine.ts"
      - "textSearchAdapter.ts"
      - "src/vs/workbench/services/search/node/ripgrepTextSearchEngine.ts"
      - "src/vs/workbench/services/search/common/searchExtTypes.ts"

  - id: vscode-extension-activation
    query: "ExtensionHostProcess setupActivationEvents"
    tool: "context_bundle"
    intent: "Understand extension activation event wiring"
    category: "api"
    repo: "vscode"
    expected:
      paths:
        - "src/vs/workbench/api/common/extHostExtensionService.ts"
        - "src/vs/workbench/api/node/extensionHostProcess.ts"
    tags: ["extension", "activation"]
    hints:
      - "setupActivationEvents"
      - "ExtensionHostProcess"
      - "extHostExtensionService"
      - "extensionHostProcess.ts"
      - "src/vs/workbench/api/common/extHostExtensionService.ts"
      - "src/vs/workbench/services/extensions/browser/extensionHostProcess.ts"

  - id: vscode-settings-sync
    query: "settings sync keybindings merge conflict"
    tool: "context_bundle"
    intent: "Review settings sync merge logic"
    category: "feature"
    repo: "vscode"
    expected:
      paths:
        - "src/vs/platform/userDataSync/common/settingsSync.ts"
        - "src/vs/platform/userDataSync/common/abstractSynchronizer.ts"
        - "src/vs/platform/userDataSync/common/userDataSync.ts"
        - "src/vs/platform/userDataSync/common/keybindingsMerge.ts"
      patterns:
        - "src/vs/platform/userDataSync/**/*.ts"
    tags: ["sync", "settings"]
    hints:
      - "keybindingsMerge"
      - "SyncResource"
      - "settingsSync.ts"
      - "abstractSynchronizer"
      - "userDataSync"
      - "IUserDataSynchroniser"
      - "src/vs/platform/userDataSync/common/settingsSync.ts"
      - "src/vs/platform/userDataSync/common/abstractSynchronizer.ts"
      - "src/vs/platform/userDataSync/common/userDataSync.ts"

  - id: vscode-microtask-debug
    query: "microtaskQueue tracer schedule vs/base"
    tool: "context_bundle"
    intent: "Inspect microtask queue tracer"
    category: "debug"
    repo: "vscode"
    expected:
      paths:
        - "src/vs/platform/telemetry/common/telemetryUtils.ts"
    tags: ["microtask", "telemetry"]
    hints:
      - "MicrotaskQueueTracer"
      - "scheduleMicrotask"
      - "microtaskQueue.ts"
      - "telemetryUtils.ts"
      - "src/vs/base/common/microtaskQueue.ts"
      - "src/vs/platform/telemetry/common/telemetryUtils.ts"

  - id: vscode-task-terminal
    query: "TaskTerminalShellIntegration registerRunProfiles"
    tool: "context_bundle"
    intent: "Understand task terminal shell integration run profiles"
    category: "feature"
    repo: "vscode"
    expected:
      paths:
        - "src/vs/workbench/contrib/tasks/browser/terminalTaskSystem.ts"
    tags: ["task", "terminal"]
    hints:
      - "TaskTerminalShellIntegration"
      - "registerRunProfiles"
      - "terminalTaskSystem.ts"
      - "src/vs/workbench/contrib/tasks/browser/terminalTaskSystem.ts"
      - "src/vs/workbench/contrib/tasks/browser/terminalTaskSystemContribution.ts"
      - "terminalTaskSystemContribution"

  - id: kiri-docs-runbook-degrade
    query: "tag:degrade metrics アラート Runbook"
    intent: "Find the degrade recovery runbook using front matter tags and inbound link boost"
    category: "docs"
    repo: "kiri-docs"
    params:
      boostProfile: "docs"
      timeoutMs: 30000
    expected:
      paths:
        - "docs/runbook.md"
        - "docs/operations.md"
        - "docs/search-ranking.md"
    tags: ["docs", "operations", "metadata", "links"]
    requiresMetadata: true
    requiresInboundLinks: true
    notes: "Validation target for Markdown front matter tags and markdown_link counts."

  - id: kiri-docs-security-windows
    query: "category:security Windows パイプ リスク"
    intent: "Locate Windows-specific security policy via category metadata"
    category: "docs"
    repo: "kiri-docs"
    params:
      boostProfile: "docs"
    expected:
      paths:
        - "docs/security.md"
        - "docs/runbook.md"
    tags: ["docs", "security", "metadata"]
    requiresMetadata: true
    notes: "Requires front matter category=security to rank above other docs."

  - id: kiri-docs-search-ranking-profile
    query: "tag:ranking boost_profile docs ブラックリスト"
    intent: "Check search-ranking guide for doc boost behavior"
    category: "docs"
    repo: "kiri-docs"
    params:
      boostProfile: "balanced"
    expected:
      paths:
        - "docs/search-ranking.md"
        - "docs/overview.md"
    tags: ["docs", "ranking", "metadata"]
    requiresMetadata: true
    notes: "Ensures metadata tags (ranking) are indexed from Markdown front matter."

  - id: kiri-docs-operations-observability
    query: "tag:observability SLO 1000ms"
    intent: "Retrieve operations observability guide via metadata-only search"
    category: "docs"
    repo: "kiri-docs"
    params:
      boostProfile: "docs"
    expected:
      paths:
        - "docs/operations.md"
        - "docs/runbook.md"
        - "docs/testing.md"
    tags: ["docs", "operations", "metadata"]
    requiresMetadata: true
    notes: "Exercises metadata-only candidate path when query is dominated by tag filters."

  - id: kiri-docs-testing-golden
    query: "tag:golden-set precision at 10"
    intent: "Find testing/evaluation expectations through front matter tags"
    category: "docs"
    repo: "kiri-docs"
    params:
      boostProfile: "docs"
    expected:
      paths:
        - "docs/testing.md"
        - "docs/search-ranking.md"
    tags: ["docs", "testing", "metadata"]
    requiresMetadata: true
    notes: "Validates doc metadata ingestion for testing guide."

  - id: kiri-docs-runbook-degrade-plain
    query: "tag:degrade metrics アラート Runbook"
    intent: "Baseline without front matter tags for degrade recovery runbook"
    category: "docs-plain"
    repo: "kiri-docs-plain"
    params:
      boostProfile: "docs"
      timeoutMs: 30000
    expected:
      paths:
        - "docs/runbook.md"
        - "docs/operations.md"
        - "docs/search-ranking.md"
    tags: ["docs", "operations", "plain"]
    requiresMetadata: true
    requiresInboundLinks: true
    notes: "Plain corpus variant of runbook query（front matter stripped）."

  - id: kiri-docs-security-windows-plain
    query: "category:security Windows パイプ リスク"
    intent: "Plain corpus: locate Windows-specific security policy"
    category: "docs-plain"
    repo: "kiri-docs-plain"
    params:
      boostProfile: "docs"
    expected:
      paths:
        - "docs/security.md"
        - "docs/runbook.md"
    tags: ["docs", "security", "plain"]
    requiresMetadata: true
    notes: "Front matterなしバージョンで metadata pass の低下を観測。"

  - id: kiri-docs-search-ranking-profile-plain
    query: "tag:ranking boost_profile docs ブラックリスト"
    intent: "Plain corpus: verify search-ranking guide retrieval"
    category: "docs-plain"
    repo: "kiri-docs-plain"
    params:
      boostProfile: "balanced"
    expected:
      paths:
        - "docs/search-ranking.md"
        - "docs/overview.md"
    tags: ["docs", "ranking", "plain"]
    requiresMetadata: true
    notes: "metadata削除による precision 低下を確認するための比較用。"

  - id: kiri-docs-operations-observability-plain
    query: "tag:observability SLO 1000ms"
    intent: "Plain corpus: operations observability guide"
    category: "docs-plain"
    repo: "kiri-docs-plain"
    params:
      boostProfile: "docs"
    expected:
      paths:
        - "docs/operations.md"
        - "docs/runbook.md"
        - "docs/testing.md"
    tags: ["docs", "operations", "plain"]
    requiresMetadata: true
    notes: "Metadata-only候補が失われた場合の fallback 精度を測定。"

  - id: kiri-docs-testing-golden-plain
    query: "tag:golden-set precision at 10"
    intent: "Plain corpus: testing/eval expectations"
    category: "docs-plain"
    repo: "kiri-docs-plain"
    params:
      boostProfile: "docs"
    expected:
      paths:
        - "docs/testing.md"
        - "docs/search-ranking.md"
    tags: ["docs", "testing", "plain"]
    requiresMetadata: true
    notes: "front matter なしでの Golden set クエリの比較。"
